import{j as o}from"./AboutSimple-Cf8x2fCZ.js";import{r as T}from"./index-BH53Isel.js";import"./EditorLayout-B4bUL1bb.js";import{h as be}from"./thumbnailGenerator-B4goYG9Y.js";import"./EditorMain-_pvTHO57.js";import{M as Q}from"./PaymentModal-Bxx5p2o_.js";import{E as ye,H as xe}from"./jspdf.es.min-CHaihsQY.js";import{G as X}from"./Global-ErywZRdd.js";import{X as ae}from"./x-DBMwyD6F.js";import{C as we}from"./chevron-left-B2s3ZsB7.js";import{C as ve}from"./chevron-right-Ckt5D2ka.js";import{D as Pe}from"./download-Dh5rRDOT.js";import"./index-yBjzXJbu.js";import"./index-fNjTmf9T.js";import"./index-Chjiymov.js";import"./preload-helper-BfFHrpNk.js";import"./typeof-QjJsDpFa.js";import"./createLucideIcon-Cy5Ya80P.js";const ne={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"0",border:"none",background:"none",overflow:"visible"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:1e3}},Ce=`
    .stf__wrapper {
        margin: 0 !important;
        padding: 0 !important;
    }
    .stf__block {
        margin: 0 !important;
        padding: 0 !important;
    }
    .stf__page {
        margin: 0 !important;
        padding: 0 !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    }
    .page-container img {
        display: block;
        margin: 0;
        padding: 0;
        border: none;
        outline: none;
        image-rendering: -webkit-optimize-contrast !important;
        image-rendering: high-quality !important;
        -webkit-backface-visibility: hidden !important;
        backface-visibility: hidden !important;
        -webkit-transform: translateZ(0) !important;
        transform: translateZ(0) !important;
        -ms-interpolation-mode: bicubic !important;
    }
    .page-container {
        -webkit-font-smoothing: subpixel-antialiased !important;
        -moz-osx-font-smoothing: auto !important;
    }
`;Q.setAppElement("#app");const De=({isOpen:P,onRequestClose:A,pages:p,pageThumbnails:$={},addAlbumToCart:O,workspaceDimensions:w={width:800,height:600},layouts:Y=[],presetData:C=null,projectData:W=null,itemData:G=null})=>{const[D,ie]=T.useState(0),[_,B]=T.useState(!1),[M,K]=T.useState(!1),[le,V]=T.useState({}),[se,ee]=T.useState(!1),H=T.useRef();function ce(e,r,s,i,v,l){const t=r.width,n=r.height,a=v/l,h=t/n;let f=0,S=0,x=t,g=n;a>h?(g=t/a,S=(n-g)/2):(x=n*a,f=(t-x)/2),e.drawImage(r,f,S,x,g,s,i,v,l)}function de(e){const r=e.match(/grid-cols-(\d+)/),s=e.match(/grid-rows-(\d+)/),i=e.match(/gap-(\d+)/);return{cols:r?parseInt(r[1],10):1,rows:s?parseInt(s[1],10):1,gap:i?parseInt(i[1],10)*4:0}}function te(e,r,s=1){const i=e&&e.match(new RegExp(`${r}-span-(\\d+)`));return i?parseInt(i[1],10):s}function ge(e,r,s){const{cols:i,rows:v,gap:l}=de(e.template),t=e.style&&e.style.padding?parseInt(e.style.padding):0,n=r.width-2*t,a=r.height-2*t,h=(n-l*(i-1))/i,f=(a-l*(v-1))/v,S=Array.from({length:v},()=>Array(i).fill(!1)),x={};for(let g=0;g<e.cells;g++){const E=e.cellStyles&&e.cellStyles[g]?e.cellStyles[g]:"",c=te(E,"col",1),d=te(E,"row",1);let u=!1;for(let b=0;b<=v-d&&!u;b++)for(let F=0;F<=i-c&&!u;F++){let z=!0;for(let y=b;y<b+d;y++){for(let j=F;j<F+c;j++)if(S[y][j]){z=!1;break}if(!z)break}if(z){for(let j=b;j<b+d;j++)for(let k=F;k<F+c;k++)S[j][k]=!0;const y=s&&s[g]?s[g].id:g;x[y]={x:t+F*(h+l),y:t+b*(f+l),width:h*c+l*(c-1),height:f*d+l*(d-1)},console.log(`[GRID-PLACEMENT] cellId:${y} col-span:${c} row-span:${d} => x:${x[y].x} y:${x[y].y} w:${x[y].width} h:${x[y].height}`),u=!0}}if(!u){const b=s&&s[g]?s[g].id:g;console.warn(`[GRID-PLACEMENT] No se pudo ubicar la celda ${b}`),x[b]={x:0,y:0,width:h,height:f}}}return x}const me=T.useCallback(async()=>{if(!p||p.length===0||!P)return;console.log("üöÄ Iniciando generaci√≥n de thumbnails para BookPreview..."),ee(!0),V({});const e={},r=4,s=(t,n,a,h)=>{if(!n||!n.image)return;const f=new Image;f.src=n.image,f.onload=()=>{const S=a.x+n.x*h,x=a.y+n.y*h,g=n.width*h,E=n.height*h;ce(t,f,S,x,g,E)}},i=async(t,n)=>{const a=document.createElement("canvas"),h=a.getContext("2d");if(a.width=w.width*r,a.height=w.height*r,C&&C.final_layer_image){const g=new Image;g.src=C.final_layer_image,g.onload=()=>{h.drawImage(g,0,0,a.width,a.height)}}const f=Y.find(g=>g.id===t.layoutId);if(!f)return;const S=ge(f,w,t.cells);t.cells.forEach(g=>{const E=S[g.id];E&&g.elements.forEach(c=>{s(h,c,E,r)})});const x=a.toDataURL("image/jpeg",.9);return{[n]:x}},v=p.map((t,n)=>i(t,n));(await Promise.all(v)).forEach(t=>{Object.assign(e,t)}),V(e),ee(!1)},[p,P,w,Y,C]),he=T.useCallback(async()=>{if(!p||p.length===0){alert("No hay p√°ginas para generar el PDF");return}K(!0);try{console.log("üöÄ Iniciando generaci√≥n de PDF con captura DOM...");let e=w.width*.0264583,r=w.height*.0264583;C!=null&&C.width&&(C!=null&&C.height)&&(e=C.width,r=C.height);const s=.3,i=e+s*2,v=r+s*2,l=i*28.35,t=v*28.35;console.log("üìè Dimensiones PDF con sangrado profesional:",{originalWidthCm:e,originalHeightCm:r,printWidthCm:i,printHeightCm:v,widthPt:l,heightPt:t,bleedCm:s});const n=new ye({orientation:l>t?"landscape":"portrait",unit:"pt",format:[l,t],compress:!1}),a=p.length;let h=0;const f=document.createElement("div");f.id="pdf-progress",f.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",f.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-4">Generando PDF de alta calidad...</h3>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="pdf-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">
                        <span id="current-page">0</span> de ${a} p√°ginas procesadas
                    </p>
                </div>
            `,document.body.appendChild(f);const S=c=>{const d=c/a*100,u=document.getElementById("pdf-progress-bar"),b=document.getElementById("current-page");u&&(u.style.width=`${d}%`),b&&(b.textContent=c)},x=async c=>{try{const d=p[c],u=document.querySelector(`#page-${d.id}`);if(!u)return console.warn(`‚ùå No se encontr√≥ elemento DOM para p√°gina ${d.id}`),null;console.log(`üì∏ Capturando p√°gina ${c+1} con DOM: ${d.id}`);const b=11.81,F=1;let z=(d==null?void 0:d.backgroundColor)||"#ffffff";const y=getComputedStyle(u);y.backgroundColor&&y.backgroundColor!=="rgba(0, 0, 0, 0)"&&(z=y.backgroundColor);const j={scale:b,useCORS:!0,allowTaint:!1,backgroundColor:z,width:w.width,height:w.height,x:0,y:0,scrollX:0,scrollY:0,foreignObjectRendering:!0,removeContainer:!1,logging:!1,imageTimeout:6e4,pixelRatio:3,onclone:async N=>{console.log(`üîç Procesando clonado para p√°gina ${c+1}...`),[".toolbar",".ui-element",".floating",".overlay",".modal",".popover",".text-toolbar",".element-selector",".element-controls",".resize-handle",".resize-control-handle",".resize-manipulation-indicator",".sidebar",".panel",".btn",".button",".control",".menu",".dropdown",".tooltip",".pointer-events-none",'[data-exclude-thumbnail="true"]'].forEach(m=>{try{N.querySelectorAll(m).forEach(Z=>Z.remove())}catch(I){console.warn("Error removing selector:",m,I)}});try{const m=N.querySelector(`#page-${d.id}`);m&&(m.style.width=w.width+"px",m.style.height=w.height+"px",m.style.position="relative",m.style.overflow="hidden",d!=null&&d.backgroundImage&&(console.log(`üñºÔ∏è Aplicando backgroundImage: ${d.backgroundImage}`),m.style.backgroundImage=`url(${d.backgroundImage})`,m.style.backgroundSize="cover",m.style.backgroundPosition="center",m.style.backgroundRepeat="no-repeat"),d!=null&&d.backgroundColor&&(console.log(`üé® Aplicando backgroundColor: ${d.backgroundColor}`),m.style.backgroundColor=d.backgroundColor))}catch(m){console.error("‚ùå Error configurando elemento de p√°gina:",m)}try{console.log("üîß Iniciando pre-procesamiento avanzado de im√°genes...");const m=new Map;u.querySelectorAll('[data-element-type="image"] img, .workspace-image, img').forEach((R,Ne)=>{if(R.complete&&R.naturalWidth>0){const re=(R.closest('[data-element-type="image"]')||R.parentElement).getBoundingClientRect();m.set(R.src,{src:R.src,naturalWidth:R.naturalWidth,naturalHeight:R.naturalHeight,containerWidth:re.width,containerHeight:re.height,objectFit:getComputedStyle(R).objectFit||"cover",objectPosition:getComputedStyle(R).objectPosition||"center",crossOrigin:R.crossOrigin})}});const Z=N.createElement("style");Z.textContent=`
                                    /* Configuraci√≥n de p√°gina */
                                    #page-${d.id} {
                                        width: ${w.width}px !important;
                                        height: ${w.height}px !important;
                                        position: relative !important;
                                        overflow: hidden !important;
                                        box-sizing: border-box !important;
                                        background-size: cover !important;
                                        background-position: center !important;
                                        background-repeat: no-repeat !important;
                                    }
                                    
                                    /* Im√°genes profesionales para PDF 300 DPI */
                                    img {
                                        width: 100% !important;
                                        height: 100% !important;
                                        object-fit: cover !important;
                                        object-position: center !important;
                                        display: block !important;
                                        image-rendering: -webkit-optimize-contrast !important;
                                        image-rendering: -webkit-crisp-edges !important;
                                        image-rendering: -moz-crisp-edges !important;
                                        image-rendering: pixelated !important;
                                        image-rendering: crisp-edges !important;
                                        image-rendering: optimizeQuality !important;
                                        backface-visibility: hidden !important;
                                        transform: translateZ(0) scale(1) !important;
                                        will-change: transform !important;
                                        filter: contrast(1.02) saturate(1.05) !important;
                                        max-width: none !important;
                                        max-height: none !important;
                                        border: none !important;
                                        outline: none !important;
                                    }
                                    
                                    /* Contenedores de imagen */
                                    [data-element-type="image"] {
                                        overflow: hidden !important;
                                        position: relative !important;
                                    }
                                    
                                    [data-element-type="image"] > div {
                                        width: 100% !important;
                                        height: 100% !important;
                                        overflow: hidden !important;
                                    }
                                    
                                    /* Optimizaciones generales para PDF */
                                    * {
                                        -webkit-font-smoothing: antialiased !important;
                                        -moz-osx-font-smoothing: grayscale !important;
                                        text-rendering: optimizeLegibility !important;
                                        -webkit-backface-visibility: hidden !important;
                                        backface-visibility: hidden !important;
                                        -webkit-transform: translateZ(0) !important;
                                        transform: translateZ(0) !important;
                                    }
                                    
                                    /* Elementos de texto de alta calidad */
                                    p, span, div, h1, h2, h3, h4, h5, h6, [contenteditable] {
                                        text-rendering: optimizeLegibility !important;
                                        -webkit-font-smoothing: antialiased !important;
                                        -moz-osx-font-smoothing: grayscale !important;
                                        font-smooth: always !important;
                                    }
                                    
                                    /* Elementos vectoriales de alta calidad */
                                    svg, path, circle, rect, line {
                                        shape-rendering: geometricPrecision !important;
                                        vector-effect: non-scaling-stroke !important;
                                    }
                                `,N.head.appendChild(Z),console.log("‚úÖ CSS para PDF aplicado correctamente")}catch(m){console.error("‚ùå Error en pre-procesamiento avanzado:",m)}}},k=await be(u,j);if(!k)throw new Error("html2canvas no devolvi√≥ un canvas v√°lido");if(k){const N=k.getContext("2d");if(N){N.imageSmoothingEnabled=!1,N.imageSmoothingQuality="high";const J=N.getImageData(0,0,k.width,k.height),m=J.data;for(let I=0;I<m.length;I+=4)m[I]=Math.min(255,m[I]*1.05),m[I+1]=Math.min(255,m[I+1]*1.05),m[I+2]=Math.min(255,m[I+2]*1.05);N.putImageData(J,0,0),console.log("‚úÖ Post-procesamiento de calidad aplicado")}}return console.log(`‚úÖ P√°gina ${c+1} capturada exitosamente`),k}catch(d){return console.error(`‚ùå Error capturando p√°gina ${c+1}:`,d),null}};for(let c=0;c<p.length;c++){const d=p[c];console.log(`üîÑ Procesando p√°gina ${c+1}/${a}: ${d.id}`);try{const u=await x(c);if(u){const b=u.width/u.height,F=l/t;let z,y,j=0,k=0;b>F?(z=l,y=l/b,k=(t-y)/2):(y=t,z=t*b,j=(l-z)/2);const N=u.toDataURL("image/png",1);c>0&&n.addPage([l,t]),n.addImage(N,"PNG",j,k,z,y),console.log(`‚úÖ P√°gina ${c+1} agregada al PDF`)}else console.warn(`‚ö†Ô∏è No se pudo capturar la p√°gina ${c+1}`),c>0&&n.addPage([l,t]),n.setFontSize(12),n.text(`Error al renderizar p√°gina ${c+1}`,l/2,t/2,{align:"center"})}catch(u){console.error(`‚ùå Error procesando p√°gina ${c+1}:`,u),c>0&&n.addPage([l,t]),n.setFontSize(12),n.text(`Error al procesar p√°gina ${c+1}`,l/2,t/2,{align:"center"})}h++,S(h),await new Promise(u=>setTimeout(u,200))}const g=`${(G==null?void 0:G.name)||(W==null?void 0:W.name)||"album"}_${new Date().toISOString().split("T")[0]}.pdf`;n.save(g),document.getElementById("pdf-progress")&&document.body.removeChild(f),console.log("‚úÖ PDF generado exitosamente:",g);const E=document.createElement("div");E.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg z-50",E.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>PDF de alta calidad generado: ${g}</span>
                </div>
            `,document.body.appendChild(E),setTimeout(()=>{document.body.contains(E)&&document.body.removeChild(E)},5e3)}catch(e){console.error("‚ùå Error generando PDF:",e);const r=document.getElementById("pdf-progress");r&&document.body.contains(r)&&document.body.removeChild(r);const s=document.createElement("div");s.className="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg z-50",s.innerHTML=`
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Error al generar PDF: ${e.message}</span>
                </div>
            `,document.body.appendChild(s),setTimeout(()=>{document.body.contains(s)&&document.body.removeChild(s)},5e3)}finally{K(!1)}},[p,w,C,G,W]);T.useEffect(()=>{P&&(Object.keys($).length===0?me():V($))},[P,$]),T.useEffect(()=>{P||V({})},[P]);const oe=Object.keys($).length>0?$:le;if(!p||!Array.isArray(p)||p.length===0)return o.jsx(Q,{isOpen:P,onRequestClose:A,style:ne,contentLabel:"Vista previa del √°lbum",ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:o.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md mx-auto",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h2",{id:"modal-title",className:"text-xl font-bold",children:"Vista previa del √°lbum"}),o.jsx("button",{onClick:A,className:"text-gray-500 hover:text-gray-700","aria-label":"Cerrar vista previa",children:o.jsx(ae,{size:24})})]}),o.jsx("p",{id:"modal-description",className:"text-gray-600",children:"No hay p√°ginas disponibles para mostrar."})]})});const pe=()=>{H.current&&H.current.pageFlip().flipPrev()},ue=()=>{H.current&&H.current.pageFlip().flipNext()},fe=w.width/w.height,L=600,U=Math.round(L*fe),q=(()=>{const e=[],r=[...p.filter(i=>i.type==="cover"),...p.filter(i=>i.type==="content"),...p.filter(i=>i.type==="final")];r.length>0&&(e.push(r[0]),e.push({...r[0],isBack:!0}));for(let i=1;i<r.length-1;i++)e.push(r[i]),i+1<r.length-1?(e.push(r[i+1]),i++):e.push({...r[i],isBack:!0,isEmpty:!0});const s=r.find(i=>i.type==="final");return s&&(e.push({...s,isBack:!0,isEmpty:!0}),e.push(s)),e})();return o.jsxs(Q,{isOpen:P,onRequestClose:A,style:ne,contentLabel:"Vista previa del √°lbum",ariaHideApp:!0,shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title","aria-describedby":"modal-description",children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:Ce}}),(se||M)&&o.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl flex flex-col items-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mb-4"}),o.jsx("p",{className:"text-gray-700",children:M?"Generando PDF de alta calidad...":"Generando vistas previas de alta calidad..."}),o.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Esto puede tomar unos segundos"})]})}),o.jsxs("div",{className:"relative flex flex-col items-center justify-center p-6 bg-white rounded-2xl shadow-2xl",children:[o.jsx("h2",{id:"modal-title",className:"sr-only",children:"Vista previa del √°lbum"}),o.jsx("p",{id:"modal-description",className:"sr-only",children:"Navegue por las p√°ginas de su √°lbum usando los controles de navegaci√≥n o teclado. Puede cerrar esta ventana presionando Escape o el bot√≥n de cerrar."}),o.jsx("button",{onClick:A,className:"absolute top-4 right-4 p-2 rounded-full bg-white/80 hover:bg-white text-gray-700 shadow z-10","aria-label":"Cerrar vista previa del √°lbum",children:o.jsx(ae,{className:"h-6 w-6"})}),o.jsxs("div",{className:"flex items-center justify-center gap-8 mb-6 mt-2",children:[o.jsx("button",{onClick:pe,className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 shadow transition-colors","aria-label":"P√°gina anterior",children:o.jsx(we,{className:"h-6 w-6"})}),o.jsxs("span",{className:"flex items-center text-gray-700 text-base font-medium px-4 py-2 bg-gray-50 rounded-lg","aria-live":"polite",children:[(()=>{const e=q[D];return e?e.isBack&&e.isEmpty?"Reverso":e.isBack?"Reverso de la p√°gina":e.type==="cover"?"Portada":e.type==="final"?"Contraportada":`P√°gina ${e.pageNumber||Math.ceil((D+1)/2)}`:"Cargando..."})(),o.jsx("span",{className:"mx-2 text-gray-400",children:"‚Ä¢"}),Math.ceil((D+1)/2)," / ",Math.ceil(q.length/2)," hojas"]}),o.jsx("button",{onClick:ue,className:"p-3 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 shadow transition-colors","aria-label":"P√°gina siguiente",children:o.jsx(ve,{className:"h-6 w-6"})})]}),o.jsx("div",{className:"flex items-center justify-center",children:o.jsx(xe,{ref:H,width:U,height:L,size:"stretch",minWidth:U*.7,maxWidth:U*1.3,minHeight:L*.7,maxHeight:L*1.3,maxShadowOpacity:.3,showCover:!0,mobileScrollSupport:!0,onFlip:e=>ie(e.data),className:"shadow-xl",usePortrait:!1,startPage:0,drawShadow:!0,flippingTime:600,useMouseEvents:!0,swipeDistance:50,showPageCorners:!0,disableFlipByClick:!1,style:{margin:0,padding:0},children:q.map((e,r)=>o.jsx("div",{id:`page-${e.id}`,className:"page-container",style:{width:U,height:L,margin:0,padding:0,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#ffffff"},children:o.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.isEmpty||e.isBack?o.jsx("div",{className:"flex items-center justify-center text-gray-300 text-xs",style:{width:"100%",height:"100%",backgroundColor:"#ffffff",border:"1px solid #f0f0f0"},children:e.isBack?"Reverso":""}):oe[e.id]?o.jsx("img",{src:oe[e.id],alt:`${e.type==="cover"?"Portada":e.type==="final"?"Contraportada":`P√°gina ${e.pageNumber||r+1}`}`,style:{width:"100%",height:"100%",objectFit:"contain",margin:0,padding:0,border:"none",imageRendering:"auto",backgroundColor:"#ffffff",WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden",WebkitTransform:"translateZ(0)",transform:"translateZ(0)"}}):o.jsx(Ee,{page:e,pageIdx:r})})},`page-${r}`))})})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 w-full max-w-2xl mx-auto",children:[o.jsx("button",{className:`flex-1 py-3 px-4 rounded-lg font-semibold shadow transition flex items-center justify-center ${M?"bg-blue-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,onClick:he,disabled:M||_,children:M?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generando PDF..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Pe,{className:"h-5 w-5 mr-2"}),"Descargar PDF"]})}),o.jsx("button",{className:`flex-1 py-3 px-4 rounded-lg font-semibold shadow transition flex items-center justify-center ${_?"bg-purple-400 text-white cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,onClick:async()=>{var e,r,s,i,v;if(!_){B(!0),console.log("üöÄ === INICIO PROCESO COMPRA (SIN PDF FRONTEND) ===");try{if(console.log("üîç Verificando funci√≥n addAlbumToCart..."),console.log("addAlbumToCart type:",typeof O),console.log("addAlbumToCart value:",O),typeof O!="function"){console.error("‚ùå addAlbumToCart no es una funci√≥n"),alert("Error: Funci√≥n de carrito no disponible. Int√©ntelo nuevamente."),B(!1);return}console.log("üõí Agregando √°lbum al carrito y preparando para PDF backend...");let l;try{const t=O();t&&typeof t.then=="function"?l=await t:l=t,console.log("‚úÖ Resultado de addAlbumToCart:",l)}catch(t){console.error("‚ùå Error en addAlbumToCart:",t),alert("Error al agregar al carrito: "+t.message),B(!1);return}if(!l){console.error("‚ùå No se pudo agregar al carrito"),alert("Error al agregar el √°lbum al carrito. Revise la consola para m√°s detalles."),B(!1);return}console.log("‚úÖ √Ålbum agregado al carrito exitosamente"),console.log("üìÑ El PDF se generar√° autom√°ticamente en el backend con dimensiones exactas de BD");try{const t=`${((e=window.Global)==null?void 0:e.APP_CORRELATIVE)||"bananalab"}_cart`,a=JSON.parse(localStorage.getItem(t)||"[]").find(h=>h.type==="custom_album"&&h.project_id&&h.pdf_data);a?console.log("üìÑ Datos para PDF backend confirmados:",{project_id:a.project_id,has_pdf_data:!!a.pdf_data,dimensions:(r=a.pdf_data)==null?void 0:r.dimensions}):console.warn("‚ö†Ô∏è No se encontraron datos de PDF en el carrito")}catch(t){console.warn("‚ö†Ô∏è Error verificando datos de PDF:",t)}console.log("üîÑ Iniciando redirecci√≥n al carrito...");try{console.log("‚è±Ô∏è Esperando 1 segundo para asegurar persistencia..."),await new Promise(a=>setTimeout(a,1e3));let t=[];for(let a=0;a<3&&(t=JSON.parse(localStorage.getItem(`${((s=window.Global)==null?void 0:s.APP_CORRELATIVE)||"bananalab"}_cart`)||"[]"),console.log(`üîç Verificaci√≥n ${a+1}/3 del carrito:`,t.length,"items"),!(t.length>0));a++)a<2&&(console.log("‚è±Ô∏è Esperando 500ms m√°s..."),await new Promise(h=>setTimeout(h,500)));if(t.length===0){console.warn("‚ö†Ô∏è Carrito sigue vac√≠o, intentando forzar adici√≥n...");try{const a=O();a&&typeof a.then=="function"&&await a,await new Promise(h=>setTimeout(h,500)),t=JSON.parse(localStorage.getItem(`${((i=window.Global)==null?void 0:i.APP_CORRELATIVE)||"bananalab"}_cart`)||"[]"),console.log("üîç Verificaci√≥n despu√©s de adici√≥n forzada:",t.length,"items")}catch(a){console.error("‚ùå Error en adici√≥n forzada:",a)}}const n=`${X.APP_URL}/cart`;console.log("üîÑ Redirigiendo a:",n),console.log("üîÑ Estado final del carrito:",t.length,"items");try{window.location.href=n}catch(a){console.error("‚ùå Error con window.location.href:",a);try{window.location.replace(n)}catch(h){console.error("‚ùå Error con window.location.replace:",h),window.open(n,"_self")}}}catch(t){console.error("‚ùå Error durante redirecci√≥n:",t);const n=`${X.APP_URL}/cart`;console.log("üîÑ Redirecci√≥n de emergencia a:",n),setTimeout(()=>{try{window.location.href=n}catch{window.location=n}},100)}}catch(l){console.error("‚ùå === ERROR GENERAL ==="),console.error("Tipo:",l.name),console.error("Mensaje:",l.message),console.error("Stack:",l.stack);try{if(JSON.parse(localStorage.getItem(`${((v=window.Global)==null?void 0:v.APP_CORRELATIVE)||"bananalab"}_cart`)||"[]").length>0){console.log("‚úÖ Hay items en carrito, redirigiendo..."),window.location.href=`${X.APP_URL}/cart`;return}}catch(t){console.error("‚ùå Error en recuperaci√≥n:",t)}alert(`Error: ${l.message}. Si el √°lbum se agreg√≥, puede ir manualmente al carrito.`)}finally{console.log("üîÑ Desbloqueando bot√≥n..."),B(!1),setTimeout(()=>{console.log("üîÑ Timeout: Desbloqueando bot√≥n (respaldo)..."),B(!1)},2e3)}}},disabled:_||M,children:_?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Procesando..."]}):"Comprar ahora"}),o.jsx("button",{className:"flex-1 py-3 px-4 rounded-lg bg-gray-200 text-gray-700 font-semibold shadow hover:bg-gray-300 transition",onClick:A,disabled:_||M,children:"Continuar editando"})]}),"        "]})},Ee=({page:P,pageIdx:A})=>{let p="",$="";switch(P.type){case"cover":p="Portada",$="üìö";break;case"final":p="Contraportada",$="üìñ";break;case"content":p=`P√°gina ${P.pageNumber||A+1}`,$="üìÑ";break;default:p=`P√°gina ${A+1}`,$="üìÑ"}return o.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full bg-gray-50 border-2 border-gray-200 rounded-lg",style:{minHeight:"400px"},children:[o.jsx("div",{className:"text-6xl mb-4",children:$}),o.jsx("div",{className:"text-lg font-semibold text-gray-700 mb-2",children:p}),o.jsx("div",{className:"text-sm text-gray-500",children:"Vista previa"}),P.layout&&o.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Layout: ",P.layout.name||"Personalizado"]})]})};export{De as B};
