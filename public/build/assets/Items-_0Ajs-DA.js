import{j as r}from"./AboutSimple-Cf8x2fCZ.js";import{B as Ge}from"./Base-C1oFhUjr.js";import{S as P}from"./SwitchFormGroup-CGYpv_4Q.js";import{T as Be}from"./TextareaFormGroup-DVzYJtLM.js";import{r as s}from"./index-BH53Isel.js";import{c as Me}from"./ReactAppend-DTVVXReZ.js";import{s as E}from"./server.browser-Bf4gQIc7.js";import{S as Oe}from"./ProductCard-Ap6bpF1Q.js";import{I as je}from"./ItemsRest-KHImAcGG.js";import{C as Ue}from"./CanvasPresetsRest-DuZw8WsH.js";import{M as de}from"./Modal-CIqmjseY.js";import{T as Le}from"./Table-DitbKwtZ.js";import{I as C}from"./ImageFormGroup-BPR9pDAU.js";import{I as S}from"./InputFormGroup-D5I6zpZc.js";import{Q as Ve}from"./QuillFormGroup-D8zDHSfJ.js";import{S as ge}from"./SelectAPIFormGroup-BYWbn4kr.js";import{S as z}from"./SelectFormGroup-YqB1XVb8.js";import{D as he}from"./DxButton-DV0H-ZcL.js";import{C as qe}from"./CreateReactScript-BoGwggCx.js";import{N as xe}from"./Number2Currency-e57Tgsuk.js";import{R as I}from"./ReactAppend-D7S498fx.js";import{S as be}from"./SetSelectValue-UxyCmHse.js";import"./main-BvVILmTO.js";import{t as ze}from"./index-Bx7_DjT0.js";import"./index-yBjzXJbu.js";import"./Global-ErywZRdd.js";import"./tippy-react.esm-GxPckcbS.js";import"./index-BrXtjC9y.js";import"./index-fNjTmf9T.js";/* empty css              */import"./Logout-7s5dsuEK.js";import"./MenuItemContainer-C_dOKkRB.js";import"./index.esm-DAJ8Pwbk.js";import"./index-xsH4HHeE.js";import"./___vite-browser-external_commonjs-proxy-0zb4Agf2.js";import"./BasicRest-b6WIUDlY.js";/* empty css               */import"./General-BmbBKdsB.js";import"./LaravelSession-Dz9cpV3l.js";const ve=({label:y,structure:d,value:j=[],onChange:g,typeOptions:N=[]})=>{const[h,x]=s.useState([]),b=typeof d=="object"&&!Array.isArray(d);s.useEffect(()=>{x(b?j.map(i=>{var a,m;return{...i,type:((a=i.type)==null?void 0:a.charAt(0).toUpperCase())+((m=i.type)==null?void 0:m.slice(1).toLowerCase())}}):j.map(i=>typeof i=="object"?i.feature||"":i))},[j]);const F=()=>{const i=b?{...d}:"",a=[...h,i];x(a),g(a)},p=i=>{const a=h.filter((m,c)=>c!==i);x(a),g(a)},v=(i,a,m)=>{const c=[...h];b?c[i][a]=a==="type"?m.charAt(0).toUpperCase()+m.slice(1).toLowerCase():m:c[i]=m,x(c),g(c)},w=(i,a)=>i==="title"&&a==="Icono"?"Url de icono":i;return r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:y}),h.map((i,a)=>r.jsx("div",{className:"row g-2 mb-2",children:b?r.jsxs(r.Fragment,{children:[Object.keys(d).map(m=>r.jsx("div",{className:"col",children:m==="type"?r.jsxs("select",{className:"form-select",value:i[m]||"",onChange:c=>v(a,m,c.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar..."}),N.map(c=>r.jsx("option",{value:c,children:c},c))]}):r.jsx("input",{type:"text",className:"form-control",value:i[m]||"",onChange:c=>v(a,m,c.target.value),placeholder:w(m,i.type)})},m)),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>p(a),children:"X"})})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"col",children:r.jsx("input",{type:"text",className:"form-control",value:i,onChange:m=>v(a,null,m.target.value),placeholder:"Característica"})}),r.jsx("div",{className:"col-auto",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>p(a),children:"X"})})]})},a)),r.jsx("button",{type:"button",className:"btn btn-primary mt-2",onClick:F,children:"+ Agregar"})]})},Je=new je,Qe=({gridRef:y,modalRef:d})=>{const[j,g]=s.useState(null),[N,h]=s.useState(!1),[x,b]=s.useState(""),[F,p]=s.useState(!1),v=i=>{g(i.target.files[0])},w=async()=>{var a,m;if(!j){b("Por favor, selecciona un archivo."),p(!0);return}const i=new FormData;i.append("file",j),h(!0);try{const c=await Je.importData(i);if(console.log(c),c.error){const _=Array.isArray(c.error)?c.error.join(`
`):c.error;b(`Error en la importación:
${_}`),p(!0)}else b(c.message),p(!1),$(y.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"),ze.success("Importacion completada con exito",{description:"Todos tus productos han sido importados correctamente.",duration:3e3,position:"bottom-center",richColors:!0})}catch(c){b("Error al importar: "+(((m=(a=c.response)==null?void 0:a.data)==null?void 0:m.error)||c.message)),p(!0)}h(!1)};return r.jsx("div",{className:"bg-white",children:r.jsxs("div",{className:"modal-content",children:[r.jsx("div",{className:"mb-1",children:r.jsx("a",{href:"/assets/img/salafabulosa/formato_import_products.xlsx",download:!0,children:"Descargar formato .xlsx"})}),r.jsx("div",{children:r.jsx("input",{className:"form-control",type:"file",accept:".xlsx",onChange:v})}),r.jsx("button",{onClick:w,disabled:N,className:"btn btn-primary mt-2",type:"button",children:N?"Subiendo...":"Subir Archivo"}),x&&r.jsx("div",{className:`alert ${F?"alert-danger":"alert-success"} mt-2`,role:"alert",children:r.jsx("div",{className:"alert-message",children:x})})]})})},A=new je,We=new Ue,Xe=({categories:y,brands:d,collections:j})=>{//!FALTA EDIT AND DELETEDE GALERIA
const[g,N]=s.useState([]),[h,x]=s.useState([]),[b,F]=s.useState(null),p=s.useRef(),v=s.useRef(),w=s.useRef(),i=s.useRef(),a=s.useRef(),m=s.useRef(),c=s.useRef(),_=s.useRef(),J=s.useRef(),Q=s.useRef(),W=s.useRef(),X=s.useRef(),H=s.useRef(),G=s.useRef(),B=s.useRef(),M=s.useRef(),K=s.useRef(),Y=s.useRef(),Z=s.useRef(),D=s.useRef(),O=s.useRef(),U=s.useRef(),L=s.useRef(),ee=s.useRef(),Re=s.useRef([]),ye=s.useRef([]),[we,se]=s.useState(!1),[Ce,Se]=s.useState(null),[He,Ne]=s.useState(null),[V,R]=s.useState([]),ne=s.useRef(),Ie=e=>{const l=Array.from(e.target.files).map(o=>({file:o,url:URL.createObjectURL(o)}));R(o=>[...o,...l])},Fe=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(o=>({file:o,url:URL.createObjectURL(o)}));R(o=>[...o,...l])},_e=e=>{e.preventDefault()},De=(e,t)=>{e.preventDefault(),V[t].id?R(o=>o.map((n,f)=>f===t?{...n,toDelete:!0}:n)):R(o=>o.filter((n,f)=>f!==t))};s.useEffect(()=>{(async()=>{try{const t=await We.paginate({take:100,skip:0});t!=null&&t.data&&x(t.data)}catch(t){console.error("Error cargando presets:",t)}})()},[]),s.useEffect(()=>{if(g&&g.images){const e=g.images.map(t=>({id:t.id,url:`/storage/images/item/${t.url}`}));R(e)}},[g]);const oe=e=>{var t,l,o;if(console.log("data total",e),N(e||null),e!=null&&e.id?se(!0):se(!1),w.current.value=(e==null?void 0:e.id)||"",$(i.current).val((e==null?void 0:e.category_id)||null).trigger("change"),$(a.current).val((e==null?void 0:e.collection_id)||null).trigger("change"),be(m.current,(t=e==null?void 0:e.subcategory)==null?void 0:t.id,(l=e==null?void 0:e.subcategory)==null?void 0:l.name),$(c.current).val((e==null?void 0:e.brand_id)||null).trigger("change"),_.current.value=(e==null?void 0:e.name)||"",Y.current.value=(e==null?void 0:e.sku)||"",J.current.value=(e==null?void 0:e.color)||"",Q.current.value=(e==null?void 0:e.summary)||"",W.current.value=(e==null?void 0:e.price)||0,X.current.value=(e==null?void 0:e.discount)||0,$(Z.current).val((e==null?void 0:e.canvas_preset_id)||null).trigger("change"),D.current.value=(e==null?void 0:e.pages)||1,be(H.current,(e==null?void 0:e.tags)??[],"id","name"),G.current.value=null,B.current.value=null,O.current.value=null,U.current.value=null,L.current.value=null,G.image.src=`/storage/images/item/${(e==null?void 0:e.banner)??"undefined"}`,B.image.src=`/storage/images/item/${(e==null?void 0:e.image)??"undefined"}`,M.image.src=`/storage/images/item/${(e==null?void 0:e.texture)??"undefined"}`,O.image.src=`/storage/images/item/${(e==null?void 0:e.cover_image)??"undefined"}`,U.image.src=`/storage/images/item/${(e==null?void 0:e.content_image)??"undefined"}`,L.image.src=`/storage/images/item/${(e==null?void 0:e.back_cover_image)??"undefined"}`,K.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const n=e.images.map(f=>({id:f.id,url:`/storage/images/item/${f.url}`}));R(n)}else R([]);e!=null&&e.specifications?re(e.specifications.map(n=>({type:n.type,title:n.title,description:n.description,image:n.image||""}))):re([]),ie(((o=e==null?void 0:e.features)==null?void 0:o.map(n=>typeof n=="object"?n:{feature:n}))||[]),ee.current.value=e==null?void 0:e.stock,$(v.current).modal("show")},ke=async e=>{e.preventDefault();const t=le.filter(u=>{var T;return typeof u=="string"?u.trim()!=="":typeof u=="object"?((T=u.feature)==null?void 0:T.trim())!=="":!1}),l=ce.filter(u=>u.title&&u.title.trim()!==""||u.description&&u.description.trim()!==""),o={id:w.current.value||void 0,category_id:i.current.value,collection_id:a.current.value||null,subcategory_id:m.current.value,brand_id:c.current.value,name:_.current.value,sku:Y.current.value,color:J.current.value,summary:Q.current.value,price:W.current.value,discount:X.current.value,tags:$(H.current).val(),description:K.current.value,stock:ee.current.value,canvas_preset_id:Z.current.value||null,pages:D.current.value,features:t,specifications:l},n=new FormData;for(const u in o)u==="features"||u==="specifications"?n.append(u,JSON.stringify(o[u])):n.append(u,o[u]);const f=B.current.files[0];f&&n.append("image",f);const k=M.current.files[0];k&&n.append("texture",k);const ae=G.current.files[0];ae&&n.append("banner",ae);const me=O.current.files[0];me&&n.append("cover_image",me);const ue=U.current.files[0];ue&&n.append("content_image",ue);const pe=L.current.files[0];pe&&n.append("back_cover_image",pe),V.forEach((u,T)=>{u.toDelete||(u.file?n.append(`gallery[${T}]`,u.file):n.append(`gallery_ids[${T}]`,u.id))});const fe=V.filter(u=>u.toDelete).map(u=>parseInt(u.id,10));fe.length>0&&n.append("deleted_images",JSON.stringify(fe)),console.log(n),await A.save(n)&&($(p.current).dxDataGrid("instance").refresh(),$(v.current).modal("hide"),R([]))},Te=async({id:e,value:t})=>{await A.boolean({id:e,field:"visible",value:t})&&$(p.current).dxDataGrid("instance").refresh()},q=async({id:e,field:t,value:l})=>{await A.boolean({id:e,field:t,value:l})&&$(p.current).dxDataGrid("instance").refresh()},$e=async e=>{const{isConfirmed:t}=await Oe.fire({title:"Eliminar curso",text:"¿Estás seguro de eliminar este curso?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await A.delete(e)||$(p.current).dxDataGrid("instance").refresh()},[le,ie]=s.useState([]),[ce,re]=s.useState([]),Pe=["Principal","General","Icono"],[Ke,Ye]=s.useState(!1),te=s.useRef(),Ee=e=>{const t=h.find(l=>l.id===e);F(t),t&&D.current&&(D.current.value=t.pages||1)},Ae=()=>{$(te.current).modal("show")};return r.jsxs(r.Fragment,{children:[r.jsx(Le,{gridRef:p,title:"Items",rest:A,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>oe()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"upload",text:"Importar Datos",hint:"Importar Datos",onClick:()=>Ae()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var l,o,n;e.html(E.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block fst-italic text-muted",children:(l=t.collection)==null?void 0:l.name}),r.jsx("b",{className:"d-block",children:(o=t.category)==null?void 0:o.name}),r.jsx("small",{className:"text-muted",children:(n=t.subcategory)==null?void 0:n.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"canvas_preset.name",caption:"Preset",width:"140px",cellTemplate:(e,{data:t})=>{t.canvas_preset?e.html(E.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block",children:t.canvas_preset.name}),r.jsxs("small",{className:"text-muted",children:[t.canvas_preset.width,"x",t.canvas_preset.height,"cm",t.pages&&` • ${t.pages}p`]})]}))):e.html(E.renderToString(r.jsx("i",{className:"text-muted",children:"Sin preset"})))}},{dataField:"name",caption:"Nombre",minWidth:"300px",cellTemplate:(e,{data:t})=>{const o=((n,f)=>{if(!n)return"";const k=n.split(" ");return k.length>f?k.slice(0,f).join(" ")+"...":n})(t.summary,12);e.html(E.renderToString(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{children:o})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(E.renderToString(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",xe(t.price)]}),r.jsxs("span",{children:["S/.",xe(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{console.log("data.image",t.image),I(e,r.jsx("img",{src:`/storage/images/item/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.is_new===1||t.is_new==="1"||t.is_new===!0;I(e,r.jsx(P,{checked:l,onChange:o=>q({id:t.id,field:"is_new",value:o.target.checked?1:0})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.offering===1||t.offering==="1"||t.offering===!0;I(e,r.jsx(P,{checked:l,onChange:o=>q({id:t.id,field:"offering",value:o.target.checked?1:0})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.recommended===1||t.recommended==="1"||t.recommended===!0;I(e,r.jsx(P,{checked:l,onChange:o=>q({id:t.id,field:"recommended",value:o.target.checked?1:0})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{const l=t.featured===1||t.featured==="1"||t.featured===!0;I(e,r.jsx(P,{checked:l,onChange:o=>q({id:t.id,field:"featured",value:o.target.checked?1:0})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{I(e,r.jsx(P,{checked:t.visible,onChange:l=>Te({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(he({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>oe(t)})),e.append(he({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>$e(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(de,{modalRef:v,title:we?"Editar curso":"Agregar curso",onSubmit:ke,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:w,type:"hidden"}),r.jsxs("div",{className:"col-md-3",children:[r.jsx(S,{eRef:Y,label:"SKU",required:!0}),r.jsx(z,{eRef:i,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>Se(e.target.value),children:y.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(z,{eRef:a,label:"Colección",dropdownParent:"#principal-container",onChange:e=>Ne(e.target.value),children:j.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(ge,{eRef:m,label:"Subcategoría",searchAPI:"/api/admin/subcategories/paginate",searchBy:"name",filter:["category_id","=",Ce],dropdownParent:"#principal-container"}),r.jsx(z,{eRef:c,label:"Marca",dropdownParent:"#principal-container",children:d.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(S,{label:"Stock",eRef:ee,type:"number"}),r.jsxs(z,{eRef:Z,label:"Preset de Canvas",dropdownParent:"#principal-container",onChange:e=>Ee(e.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar preset..."}),h.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.width,"x",e.height,"cm, ",e.pages,"p)"]},e.id))]}),r.jsx(S,{eRef:D,label:"Número de Páginas",type:"number",min:"1",defaultValue:"1"}),r.jsx(S,{eRef:W,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(S,{eRef:X,label:"Descuento",type:"number",step:"0.01"}),r.jsx(ge,{id:"tags",eRef:H,searchAPI:"/api/admin/tags/paginate",searchBy:"name",label:"Tags",dropdownParent:"#principal-container",tags:!0,multiple:!0})]}),r.jsxs("div",{className:"col-md-5",children:[r.jsx(S,{eRef:_,label:"Nombre",required:!0}),r.jsx(S,{eRef:J,label:"Color",required:!0}),r.jsx(C,{eRef:M,label:"Imagen Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsx(Be,{eRef:Q,label:"Resumen",rows:3}),r.jsx(ve,{ref:Re,label:"Características",structure:"",value:le,onChange:ie}),r.jsx(ve,{ref:ye,label:"Especificaciones",structure:{type:"",title:"",description:""},value:ce,onChange:re,typeOptions:Pe})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsxs("div",{className:"row",children:[r.jsx(C,{eRef:G,label:"Banner",aspect:2/1,col:"col-12"}),r.jsx(C,{eRef:B,label:"Imagen Principal",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsx(C,{eRef:M,label:"Textura",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"})]}),r.jsxs("div",{className:"row",children:[r.jsx("div",{className:"col-12",children:r.jsx("h6",{className:"text-muted mb-2",children:"Imágenes de Producto"})}),r.jsx(C,{eRef:O,label:"Imagen de Portada",aspect:3/4,col:"col-lg-4 col-md-6 col-sm-4"}),r.jsx(C,{eRef:U,label:"Imagen de Contenido",aspect:3/4,col:"col-lg-4 col-md-6 col-sm-4"}),r.jsx(C,{eRef:L,label:"Imagen de Contraportada",aspect:3/4,col:"col-lg-4 col-md-6 col-sm-4"})]}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:ne,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Ie}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"209px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>ne.current.click(),onDrop:Fe,onDragOver:_e,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-lg-6 col-md-12 col-sm-6",children:r.jsx("div",{className:"d-flex flex-wrap gap-1 mt-2",children:V.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>De(l,t),children:"×"})]},t))})})]})]})]}),r.jsx("hr",{className:"my-1"}),r.jsx(Ve,{eRef:K,label:"Descripcion"})]}),r.jsx(de,{modalRef:te,title:"Importar Datos",size:"sm",children:r.jsx(Qe,{gridRef:p,modalRef:te})})]})};qe((y,d)=>{Me.createRoot(y).render(r.jsx(Ge,{...d,title:"Items",children:r.jsx(Xe,{...d})}))});
